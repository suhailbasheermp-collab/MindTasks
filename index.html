<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mind & Tasks</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="theme-color" content="#0b0c15">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Merriweather:ital@0;1&display=swap" rel="stylesheet">

    <style>
        /* --- THEME VARIABLES --- */
        :root {
            --bg-deep: #0b0c15;
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-blur: blur(16px);
            --text-main: #ffffff;
            --text-muted: rgba(255, 255, 255, 0.6);
            
            /* Palette */
            --aurora-green: #00ff9d;
            --aurora-blue: #00d2ff;
            --aurora-purple: #bd00ff;
            --aurora-pink: #ff0055;
            --gold: #d4af37;
            
            --high: var(--aurora-pink);  
            --med: var(--aurora-blue);   
            --low: var(--aurora-green);  
            --loop: #a8a8a8;
            --perma: var(--aurora-purple);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-deep);
            color: var(--text-main);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- BACKGROUND ANIMATION --- */
        .aurora-bg {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1;
            background: radial-gradient(circle at 10% 10%, rgba(11,12,21,1) 0%, rgba(22,25,40,1) 100%);
            overflow: hidden;
        }
        .aurora-blob {
            position: absolute; filter: blur(80px); opacity: 0.45;
            animation: float 15s infinite ease-in-out alternate;
        }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: var(--aurora-purple); animation-duration: 20s; }
        .blob-2 { bottom: -10%; right: -10%; width: 60vw; height: 60vw; background: var(--aurora-blue); animation-duration: 25s; }
        .blob-3 { top: 40%; left: 40%; width: 40vw; height: 40vw; background: var(--aurora-green); animation-duration: 18s; }

        @keyframes float { 0% { transform: translate(0, 0) scale(1); } 100% { transform: translate(30px, 50px) scale(1.1); } }

        /* --- FIREFLIES --- */
        .firefly-container { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events: none; z-index: 200; display: none; }
        .firefly-container.active { display: block; }
        .firefly {
            position: absolute; width: 4px; height: 4px; background: var(--aurora-green);
            border-radius: 50%; box-shadow: 0 0 10px var(--aurora-green), 0 0 20px white;
            opacity: 0; animation: fly 10s infinite alternate;
        }
        @keyframes fly {
            0% { transform: translate(0,0) scale(0.5); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; }
            100% { transform: translate(var(--moveX), var(--moveY)) scale(1); opacity: 0; }
        }

        /* --- HEADER --- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 24px;
            position: sticky; top: 0; z-index: 50;
            background: rgba(11, 12, 21, 0.75);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid var(--glass-border);
            box-shadow: 0 4px 30px rgba(0,0,0,0.1);
        }
        .brand-logo {
            display: flex; align-items: center; gap: 8px;
            font-family: 'Rajdhani', sans-serif; text-transform: uppercase; user-select: none;
        }
        .logo-mind { font-weight: 700; font-size: 1.5rem; letter-spacing: 1px; color: #fff; }
        .logo-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--aurora-green); box-shadow: 0 0 10px var(--aurora-green); animation: pulse-dot 3s infinite; }
        .logo-tasks { font-weight: 400; font-size: 1.5rem; letter-spacing: 2px; color: var(--text-muted); }
        @keyframes pulse-dot { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.8); } }

        .header-actions { display: flex; align-items: center; gap: 20px; }
        .icon-btn { background: none; border: none; font-size: 1.2rem; cursor: pointer; opacity: 0.7; transition: 0.3s; color: white; display: flex; align-items: center; justify-content: center; }
        .icon-btn:hover { opacity: 1; transform: scale(1.1); text-shadow: 0 0 10px white; }

        /* --- BANNER --- */
        .wisdom-banner {
            margin: 20px 24px 10px 24px; padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1); border-left: 3px solid var(--aurora-blue);
            border-radius: 16px; cursor: pointer; position: relative; overflow: hidden;
            backdrop-filter: blur(10px);
        }
        .banner-text { font-family: 'Merriweather', serif; font-style: italic; font-size: 1rem; line-height: 1.5; color: #eee; }
        .banner-author { display: block; margin-top: 8px; font-size: 0.75rem; text-transform: uppercase; color: var(--aurora-blue); text-align: right; letter-spacing: 1px; font-weight: bold; font-family: 'Rajdhani'; }

        /* --- MAIN CONTENT --- */
        .container { padding: 24px; padding-bottom: 100px; max-width: 600px; margin: 0 auto; }
        
        .section-label {
            font-family: 'Rajdhani', sans-serif; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px;
            color: var(--text-muted); margin: 30px 0 15px 5px; font-weight: 600;
            display: flex; align-items: center; gap: 10px;
        }
        .section-label::after { content: ''; height: 1px; background: var(--glass-border); flex: 1; }

        /* --- CARDS --- */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .card {
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 20px; text-align: left;
            backdrop-filter: var(--glass-blur);
            transition: transform 0.2s; cursor: pointer;
            position: relative; overflow: hidden;
            display: flex; flex-direction: column; justify-content: space-between;
            height: 120px;
        }
        .card:active { transform: scale(0.98); }
        .card-icon { font-size: 1.8rem; margin-bottom: auto; display: block; filter: drop-shadow(0 0 5px rgba(255,255,255,0.2)); }
        .card h3 { margin: 0; font-family: 'Rajdhani', sans-serif; font-size: 1.2rem; font-weight: 700; letter-spacing: 1px; color: white; }
        .card p { margin: 2px 0 0; font-size: 0.8rem; color: var(--text-muted); }

        /* --- TASKS --- */
        .task-list { display: flex; flex-direction: column; gap: 12px; }
        .task-item {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(22, 22, 30, 0.8);
            border: 1px solid var(--glass-border);
            border-radius: 16px; padding: 18px 20px;
            transition: all 0.3s ease; position: relative; overflow: hidden;
        }
        .task-item.red { border-left: 4px solid var(--high); }
        .task-item.yellow { border-left: 4px solid var(--med); }
        .task-item.green { border-left: 4px solid var(--low); }
        .task-item.loop { border-left: 4px solid var(--loop); }
        .task-item.marker { border-left: 4px solid var(--perma); background: rgba(189, 0, 255, 0.08); }

        .task-text { flex: 1; font-size: 1.1rem; line-height: 1.4; padding: 0 15px; color: #fff; font-weight: 400; }
        .task-actions { display: flex; gap: 15px; opacity: 0.5; transition: 0.2s; }
        .task-item:hover .task-actions { opacity: 1; }
        .task-item.done { opacity: 0.5; filter: grayscale(1); }
        .task-item.done .task-text { text-decoration: line-through; }
        
        .check-circle { width: 24px; height: 24px; border-radius: 50%; border: 2px solid var(--glass-border); background: transparent; cursor: pointer; transition: 0.2s; }
        .task-item:hover .check-circle { border-color: var(--text-muted); }

        .empty-msg { text-align: center; padding: 25px; border-radius: 16px; border: 1px dashed var(--glass-border); color: var(--text-muted); font-size: 0.9rem; cursor: pointer; transition: 0.2s; background: rgba(0,0,0,0.2); }

        /* --- FAB --- */
        .fab {
            position: fixed; bottom: 30px; right: 30px;
            width: 60px; height: 60px; border-radius: 50%;
            background: var(--text-main); color: #000; border: none; font-size: 32px;
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.25);
            cursor: pointer; z-index: 90;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.3s;
            animation: pulse-glow-white 3s infinite ease-in-out;
        }
        @keyframes pulse-glow-white {
            0%, 100% { box-shadow: 0 0 20px rgba(255,255,255,0.3); }
            50% { box-shadow: 0 0 40px rgba(255,255,255,0.6); }
        }
        .fab:hover { transform: scale(1.1); }
        .fab:active { animation: jelly 0.5s; }
        @keyframes jelly { 0% { transform: scale(1, 1); } 25% { transform: scale(0.9, 1.1); } 50% { transform: scale(1.1, 0.9); } 75% { transform: scale(0.95, 1.05); } 100% { transform: scale(1, 1); } }

        /* --- PAGE LAYERS --- */
        .page-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-deep); z-index: 60;
            transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.77, 0, 0.175, 1);
            display: flex; flex-direction: column;
        }
        .page-layer.active { transform: translateX(0); }
        .page-content { padding: 24px; flex: 1; overflow-y: auto; }
        
        .page-header-row { display: flex; align-items: center; margin-bottom: 20px; padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .back-btn { background: none; border: none; color: white; font-size: 1.5rem; margin-right: 15px; cursor: pointer; opacity: 0.8; }
        .page-title-text { font-family: 'Rajdhani', sans-serif; font-size: 1.5rem; font-weight: 700; letter-spacing: 1px; color: white; margin: 0; }
        .bottom-close { margin-top: auto; width: 100%; padding: 16px; background: rgba(255,255,255,0.1); border: none; color: white; font-family: 'Rajdhani', sans-serif; font-size: 1rem; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; }

        /* --- TIMER --- */
        .timer-content { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; flex: 1; position: relative; }
        .zen-circle {
            width: 220px; height: 220px; border-radius: 50%;
            background: radial-gradient(circle, rgba(0,210,255,0.1) 0%, rgba(0,0,0,0) 70%);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 30px; position: relative; transition: all 0.5s; z-index: 10;
        }
        .zen-circle.breathe { animation: breatheEffect 8s infinite ease-in-out; border-color: var(--aurora-blue); box-shadow: 0 0 40px var(--aurora-blue); }
        .timer-digits { font-family: 'Rajdhani', sans-serif; font-size: 4.5rem; font-weight: 200; letter-spacing: 2px; font-variant-numeric: tabular-nums; text-shadow: 0 0 20px rgba(0,0,0,0.5); z-index: 11; }
        
        .timer-input-area { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 30px; z-index: 10; }
        .t-input { background: transparent; border: none; border-bottom: 1px solid var(--aurora-blue); color: white; font-size: 2rem; width: 60px; text-align: center; font-family: 'Rajdhani'; outline: none; padding-bottom: 5px; }
        
        @keyframes breatheEffect { 0% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.15); opacity: 1; box-shadow: 0 0 80px var(--aurora-purple); } }

        /* --- MODALS --- */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(12px); z-index: 3000; display: none; justify-content: center; align-items: flex-end; }
        .modal.active { display: flex; }
        .modal.center { align-items: center; padding: 20px; }
        .sheet { width: 100%; background: #16171f; border-top-left-radius: 24px; border-top-right-radius: 24px; padding: 30px 24px; border-top: 1px solid var(--glass-border); animation: slideUp 0.3s ease; }
        .card-modal { background: #15151a; border: 1px solid var(--aurora-blue); padding: 30px; border-radius: 16px; width: 100%; max-width: 400px; text-align: center; animation: popIn 0.3s ease; box-shadow: 0 0 40px rgba(0,0,0,0.5); }
        .info-card { background: #16171f; border-radius: 24px; padding: 30px; max-width: 400px; width: 100%; border: 1px solid var(--glass-border); text-align: left; animation: popIn 0.3s ease; }
        
        .quote-text { font-family: 'Merriweather', serif; font-style: italic; font-size: 1.4rem; line-height: 1.6; margin-bottom: 20px; color: #fff; }
        .quote-author { font-family: 'Rajdhani', sans-serif; font-size: 1rem; text-transform: uppercase; letter-spacing: 2px; color: var(--aurora-blue); display: block; margin-bottom: 30px; }

        .pill-container { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .pill { flex: 0 0 auto; padding: 8px 16px; border-radius: 50px; font-size: 0.85rem; font-weight: 600; cursor: pointer; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: var(--text-muted); }
        .pill.selected { background: rgba(255,255,255,0.15); color: white; border-color: white; }
        textarea { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); color: white; padding: 16px; border-radius: 12px; font-size: 1rem; margin: 20px 0; min-height: 120px; resize: none; outline: none; font-family: inherit; }
        .btn { width: 100%; padding: 16px; border-radius: 14px; font-weight: 600; font-size: 1rem; border: none; cursor: pointer; }
        .btn-primary { background: white; color: black; box-shadow: 0 0 20px rgba(255,255,255,0.15); }
        .btn-ghost { background: rgba(255,255,255,0.1); color: white; }
        
        /* Control Buttons */
        .control-row { display: flex; gap: 15px; width: 100%; justify-content: center; margin-top: 20px; }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .hidden { display: none !important; }
        
        /* --- WELCOME --- */
        .welcome-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(15px); z-index: 9999; display: none; justify-content: center; align-items: center; padding: 20px; opacity: 1; transition: opacity 0.6s ease; }
        .welcome-card { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; padding: 30px; text-align: center; max-width: 500px; width: 100%; color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .enter-btn { background: white; color: black; border: none; padding: 15px 40px; font-size: 1.2rem; font-weight: bold; border-radius: 50px; cursor: pointer; margin-top: 20px; box-shadow: 0 0 20px rgba(255,255,255,0.4); animation: breathe 2s infinite; }

        /* --- INFO --- */
        .info-row { display: flex; align-items: center; margin-bottom: 16px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 12px; }
        .info-dot { width: 12px; height: 12px; border-radius: 50%; margin-right: 15px; flex-shrink: 0; }
        .info-icon { font-size: 1.2rem; margin-right: 15px; width: 12px; text-align: center; }
        .info-content h4 { margin: 0 0 4px 0; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; }
        .info-content p { margin: 0; font-size: 0.9rem; color: var(--text-muted); }
    </style>
</head>
<body>

    <div class="aurora-bg"><div class="aurora-blob blob-1"></div><div class="aurora-blob blob-2"></div><div class="aurora-blob blob-3"></div></div>
    <div id="fireflies" class="firefly-container"></div>
    
    <div id="welcome-overlay" class="welcome-overlay"><div class="welcome-card"><h2 style="font-family:'Rajdhani'; font-weight:700; letter-spacing:2px;">WELCOME</h2><p style="font-size:1.1rem; line-height:1.5; opacity:0.8;">Balance your tasks with mindfulness.<br>A space for clarity and action.</p><button class="enter-btn" onclick="closeWelcome()">Enter</button></div></div>

    <div id="app-home">
        <header>
            <div class="brand-logo"><span>MIND</span><div class="logo-dot"></div><span class="logo-tasks">TASKS</span></div>
            <div class="header-actions">
                <button class="icon-btn" onclick="openInfo()">‚ÑπÔ∏è</button>
                <button class="icon-btn" onclick="openTimer()">‚åõ</button>
            </div>
        </header>

        <div class="wisdom-banner" onclick="showQuote()">
            <div id="banner-text" class="banner-text">Loading wisdom...</div>
            <span id="banner-author" class="banner-author"></span>
        </div>

        <div class="container">
            <div class="section-label">Mind Space</div>
            <div class="grid">
                <div class="card" onclick="openList('loop')">
                    <span class="card-icon" style="color: #a8a8a8">‚ûø</span>
                    <div><h3>Loops</h3><p id="count-loop">0 Active</p></div>
                </div>
                <div class="card" onclick="openList('marker')">
                    <span class="card-icon" style="color: var(--aurora-purple)">‚úíÔ∏è</span>
                    <div><h3>Perma</h3><p id="count-marker">0 Truths</p></div>
                </div>
            </div>

            <div class="section-label"><span style="width:8px; height:8px; background:var(--aurora-pink); border-radius:50%; margin-right:10px; box-shadow:0 0 8px var(--aurora-pink);"></span>High Energy</div>
            <div id="list-red" class="task-list"></div>

            <div class="section-label"><span style="width:8px; height:8px; background:var(--aurora-blue); border-radius:50%; margin-right:10px; box-shadow:0 0 8px var(--aurora-blue);"></span>Flow State</div>
            <div id="list-yellow" class="task-list"></div>

            <div class="section-label"><span style="width:8px; height:8px; background:var(--aurora-green); border-radius:50%; margin-right:10px; box-shadow:0 0 8px var(--aurora-green);"></span>Gentle</div>
            <div id="list-green" class="task-list"></div>
        </div>
        
        <button id="mainFab" class="fab" onclick="openModal()">+</button>
    </div>

    <div id="page-layer" class="page-layer">
        <div class="page-header-row">
            <button class="back-btn" onclick="closePage()">‚Üê Back</button>
            <h1 class="page-title-text" id="page-title">Title</h1>
        </div>
        <div class="page-content" id="page-content-area"></div>
        <button class="bottom-close" onclick="closePage()">Close</button>
    </div>

    <div id="timer-layer" class="page-layer" style="background: #050505;">
        <header>
            <button class="icon-btn" onclick="closeTimer()">‚úï Exit</button>
            <div class="brand-logo">ZEN FOCUS</div>
            <div></div>
        </header>
        <div class="timer-content">
            <div class="zen-circle" id="breath-circle">
                <div class="timer-digits" id="timer-display">05:00</div>
            </div>
            
            <div class="timer-input-area" id="timer-setup">
                <input type="number" id="custom-min" class="t-input" value="5" min="1"> <span style="color:var(--text-muted); font-family:'Rajdhani'; font-size: 1.2rem;">MIN</span>
            </div>
            
            <p style="color: var(--text-muted); margin-bottom: 40px; font-family: 'Rajdhani', sans-serif; letter-spacing: 2px; font-weight: 600; text-shadow: 0 0 10px rgba(255,255,255,0.2);">CHANNEL YOUR FOCUS</p>
            
            <div class="control-row">
                <button class="btn btn-primary" style="max-width: 200px;" onclick="startSequence()" id="btn-start">Start Focus</button>
                
                <div id="active-controls" class="hidden" style="display:flex; gap:15px;">
                    <button id="btn-pause" class="btn btn-primary" onclick="togglePause()">Pause</button>
                    <button id="btn-stop" class="btn btn-ghost" onclick="stopTimer()">Stop</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="input-modal">
        <div class="modal-sheet">
            <h3 style="margin: 0 0 15px 0; font-weight: 400; font-family: 'Rajdhani', sans-serif; color: #fff;">ADD ENTRY</h3>
            <div class="pill-container" id="category-pills">
                <div class="pill selected" onclick="setCat('red', this)">üî• High</div>
                <div class="pill" onclick="setCat('yellow', this)">‚ö° Flow</div>
                <div class="pill" onclick="setCat('green', this)">üçÉ Gentle</div>
                <div class="pill" onclick="setCat('loop', this)">‚ûø Loop</div>
                <div class="pill" onclick="setCat('marker', this)">‚úíÔ∏è Perma</div>
            </div>
            <textarea id="input-text" placeholder="Write here..."></textarea>
            <div class="btn-row">
                <button class="btn btn-ghost" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveItem()">Save</button>
            </div>
        </div>
    </div>

    <div class="modal center" id="quote-modal" onclick="if(event.target === this) closeQuoteModal()">
        <div class="quote-card">
            <div style="font-size: 2.5rem; margin-bottom: 10px; opacity: 0.5;">üìú</div>
            <div id="modal-quote-text" class="quote-text"></div>
            <div id="modal-quote-author" class="quote-author"></div>
            <button class="btn btn-ghost" style="margin-top:15px; width:100%; border:1px solid rgba(255,255,255,0.2);" onclick="generateQuote()">Another One</button>
            <button class="btn btn-primary" style="margin-top: 10px; background:var(--aurora-blue); color:black;" onclick="closeQuoteModal()">Absorb & Close</button>
        </div>
    </div>

    <div class="modal center" id="info-modal" onclick="if(event.target === this) closeInfo()">
        <div class="info-card">
            <h3 style="margin: 0 0 20px 0; font-family: 'Rajdhani', sans-serif; text-align: center; color: #fff;">GUIDE</h3>
            <div class="info-row"><div class="info-dot" style="background: var(--aurora-pink); box-shadow: 0 0 8px var(--aurora-pink);"></div><div class="info-content"><h4>High Energy</h4><p>Urgent tasks. Do these when your energy is at its peak.</p></div></div>
            <div class="info-row"><div class="info-dot" style="background: var(--aurora-blue); box-shadow: 0 0 8px var(--aurora-blue);"></div><div class="info-content"><h4>Flow State</h4><p>Important, steady work. Requires focus but not panic.</p></div></div>
            <div class="info-row"><div class="info-dot" style="background: var(--aurora-green); box-shadow: 0 0 8px var(--aurora-green);"></div><div class="info-content"><h4>Gentle</h4><p>Low stakes. Do these when you need to relax or wind down.</p></div></div>
            <div class="info-row"><div class="info-icon">‚ûø</div><div class="info-content"><h4>Mental Loops</h4><p>Catch repetitive, unhelpful thoughts here to get them out of your head.</p></div></div>
            <div class="info-row"><div class="info-icon" style="color: var(--aurora-purple)">‚úíÔ∏è</div><div class="info-content"><h4>Perma Truths</h4><p>Deep realizations or affirmations you want to keep forever.</p></div></div>
            <button class="btn btn-primary" style="margin-top: 20px;" onclick="closeInfo()">Got it</button>
        </div>
    </div>

    <script>
        /* CACHE KILLER */
        if ('serviceWorker' in navigator) { navigator.serviceWorker.getRegistrations().then(function(registrations) { for(let registration of registrations) { registration.unregister(); } }); }

        // WELCOME
        if (!localStorage.getItem('hasVisited')) { document.getElementById('welcome-overlay').style.display = 'flex'; }
        function closeWelcome() { localStorage.setItem('hasVisited', 'true'); document.getElementById('welcome-overlay').style.opacity = '0'; setTimeout(() => { document.getElementById('welcome-overlay').style.display = 'none'; }, 600); }

        // DATA
        let items = JSON.parse(localStorage.getItem('auroraNotes')) || [];
        let currentCat = 'red';
        let activePage = null;
        
        // 168 QUOTES
        const library = [
            {t:"The wound is the place where the Light enters you.",a:"Rumi"},{t:"What you seek is seeking you.",a:"Rumi"},{t:"Stop acting so small. You are the universe in ecstatic motion.",a:"Rumi"},{t:"Silence is the language of God, all else is poor translation.",a:"Rumi"},{t:"Sell your cleverness and buy bewilderment.",a:"Rumi"},{t:"Knock, And He'll open the door.",a:"Rumi"},{t:"You were born with wings, why prefer to crawl through life?",a:"Rumi"},{t:"Don't be satisfied with stories, how things have gone with others. Unfold your own myth.",a:"Rumi"},{t:"I wish I could show you when you are lonely or in darkness the astonishing light of your own being.",a:"Hafiz"},{t:"Fear is the cheapest room in the house. I would like to see you living in better conditions.",a:"Hafiz"},{t:"The sun is within me, and so is the moon.",a:"Kabir"},{t:"Wherever you stand, be the soul of that place.",a:"Rumi"},{t:"Be empty of worrying. Think of who created thought.",a:"Rumi"},{t:"Your heart is the size of an ocean. Go find yourself in its hidden depths.",a:"Rumi"},{t:"Let yourself be silently drawn by the strange pull of what you really love. It will not lead you astray.",a:"Rumi"},{t:"Travel brings power and love back into your life.",a:"Rumi"},{t:"The mind creates the abyss, the heart crosses it.",a:"Nisargadatta Maharaj"},{t:"Wisdom is knowing I am nothing, Love is knowing I am everything.",a:"Nisargadatta Maharaj"},{t:"Everything happens on its own. You are doing nothing.",a:"Nisargadatta Maharaj"},{t:"Once you realize that the road is the goal and that you are always on the road, not to reach a goal, but to enjoy its beauty and its wisdom, life ceases to be a task and becomes natural and simple.",a:"Nisargadatta Maharaj"},
            {t:"Arise, awake, and stop not till the goal is reached.",a:"Swami Vivekananda"},{t:"You have to grow from the inside out. None can teach you, none can make you spiritual.",a:"Swami Vivekananda"},{t:"All power is within you; you can do anything and everything.",a:"Swami Vivekananda"},{t:"In a conflict between the heart and the brain, follow your heart.",a:"Swami Vivekananda"},{t:"Your own Self-Realization is the greatest service you can render the world.",a:"Ramana Maharshi"},{t:"Be as you are.",a:"Ramana Maharshi"},{t:"There is no greater mystery than this: that we keep seeking reality though in fact we are reality.",a:"Ramana Maharshi"},{t:"The degree of freedom from unwanted thoughts and the degree of concentration on a single thought are the measures to gauge spiritual progress.",a:"Ramana Maharshi"},{t:"Faith is the bird that feels the light when the dawn is still dark.",a:"Rabindranath Tagore"},{t:"Clouds come floating into my life, no longer to carry rain or usher storm, but to add color to my sunset sky.",a:"Rabindranath Tagore"},{t:"Let your life lightly dance on the edges of Time like dew on the tip of a leaf.",a:"Rabindranath Tagore"},{t:"Love is an endless mystery, for it has nothing else to explain it.",a:"Rabindranath Tagore"},{t:"Everything comes to us that belongs to us if we create the capacity to receive it.",a:"Rabindranath Tagore"},{t:"The butterfly counts not months but moments, and has time enough.",a:"Rabindranath Tagore"},{t:"The eye through which I see God is the same eye through which God sees me.",a:"Meister Eckhart"},{t:"If the only prayer you ever say in your entire life is thank you, it will be enough.",a:"Meister Eckhart"},
            {t:"Nature does not hurry, yet everything is accomplished.",a:"Lao Tzu"},{t:"To the mind that is still, the whole universe surrenders.",a:"Lao Tzu"},{t:"The journey of a thousand miles begins with a single step.",a:"Lao Tzu"},{t:"When I let go of what I am, I become what I might be.",a:"Lao Tzu"},{t:"Knowing others is intelligence; knowing yourself is true wisdom.",a:"Lao Tzu"},{t:"Peace comes from within. Do not seek it without.",a:"Buddha"},{t:"The mind is everything. What you think you become.",a:"Buddha"},{t:"Three things cannot be long hidden: the sun, the moon, and the truth.",a:"Buddha"},{t:"Start by doing what's necessary; then do what's possible; and suddenly you are doing the impossible.",a:"St. Francis of Assisi"},{t:"Preach the Gospel at all times. Use words if necessary.",a:"St. Francis of Assisi"},{t:"All shall be well, and all shall be well, and all manner of thing shall be well.",a:"Julian of Norwich"},{t:"Let nothing disturb you, let nothing frighten you. All things are passing away: God never changes.",a:"St. Teresa of Avila"},{t:"In the evening of life, we will be judged on love alone.",a:"St. John of the Cross"},{t:"Silence is God's first language.",a:"St. John of the Cross"},{t:"Simplicity is the ultimate sophistication.",a:"Leonardo da Vinci"},{t:"He who has a why to live can bear almost any how.",a:"Friedrich Nietzsche"},{t:"In the midst of winter, I found there was, within me, an invincible summer.",a:"Albert Camus"},{t:"Be the change that you wish to see in the world.",a:"Mahatma Gandhi"},{t:"Where there is love there is life.",a:"Mahatma Gandhi"},{t:"Live as if you were to die tomorrow. Learn as if you were to live forever.",a:"Mahatma Gandhi"},{t:"The weak can never forgive. Forgiveness is the attribute of the strong.",a:"Mahatma Gandhi"},{t:"If you want to know him, you must be him.",a:"Ibn Arabi"},{t:"Die before you die.",a:"Prophet Muhammad"},{t:"This place is a dream. Only a sleeper considers it real.",a:"Rumi"},{t:"The lion is most handsome when looking for food.",a:"Rumi"},{t:"Raise your words, not voice. It is rain that grows flowers, not thunder.",a:"Rumi"},
            {t:"Lovers don't finally meet somewhere. They're in each other all along.",a:"Rumi"},{t:"Seek the wisdom that will untie your knot. Seek the path that demands your whole being.",a:"Rumi"},{t:"Observe the wonders as they occur around you. Don't claim them. Feel the artistry moving through and be silent.",a:"Rumi"},{t:"Dance, when you're broken open. Dance, if you've torn the bandage off. Dance in the middle of the fighting.",a:"Rumi"},{t:"I count him braver who overcomes his desires than him who conquers his enemies; for the hardest victory is over self.",a:"Aristotle"},{t:"Knowing yourself is the beginning of all wisdom.",a:"Aristotle"},{t:"It is the mark of an educated mind to be able to entertain a thought without accepting it.",a:"Aristotle"},{t:"The unexamined life is not worth living.",a:"Socrates"},{t:"Wonder is the beginning of wisdom.",a:"Socrates"},{t:"To find yourself, think for yourself.",a:"Socrates"},{t:"He who is not contented with what he has, would not be contented with what he would like to have.",a:"Socrates"},{t:"Be kind, for everyone you meet is fighting a hard battle.",a:"Plato"},{t:"Wise men speak because they have something to say; Fools because they have to say something.",a:"Plato"},{t:"Courage is knowing what not to fear.",a:"Plato"},{t:"At the touch of love everyone becomes a poet.",a:"Plato"},{t:"You cannot shake hands with a clenched fist.",a:"Indira Gandhi"},{t:"Happiness is when what you think, what you say, and what you do are in harmony.",a:"Mahatma Gandhi"},{t:"The future depends on what you do today.",a:"Mahatma Gandhi"},{t:"I think, therefore I am.",a:"Ren√© Descartes"},{t:"That which does not kill us makes us stronger.",a:"Friedrich Nietzsche"},{t:"It does not matter how slowly you go as long as you do not stop.",a:"Confucius"},
            {t:"Real knowledge is to know the extent of one's ignorance.",a:"Confucius"},{t:"Everything has beauty, but not everyone sees it.",a:"Confucius"},{t:"Do not dwell in the past, do not dream of the future, concentrate the mind on the present moment.",a:"Buddha"},{t:"You, yourself, as much as anybody in the entire universe, deserve your love and affection.",a:"Buddha"},{t:"Health is the greatest gift, contentment the greatest wealth, faithfulness the best relationship.",a:"Buddha"},{t:"Your work is to discover your world and then with all your heart give yourself to it.",a:"Buddha"},{t:"Look deep into nature, and then you will understand everything better.",a:"Albert Einstein"},{t:"Imagination is more important than knowledge.",a:"Albert Einstein"},{t:"Life is like riding a bicycle. To keep your balance, you must keep moving.",a:"Albert Einstein"},{t:"Strive not to be a success, but rather to be of value.",a:"Albert Einstein"},{t:"I have no special talent. I am only passionately curious.",a:"Albert Einstein"},{t:"Peace cannot be kept by force; it can only be achieved by understanding.",a:"Albert Einstein"},{t:"In the middle of difficulty lies opportunity.",a:"Albert Einstein"},{t:"A person who never made a mistake never tried anything new.",a:"Albert Einstein"},{t:"We cannot solve our problems with the same thinking we used when we created them.",a:"Albert Einstein"},{t:"Only a life lived for others is a life worth living.",a:"Albert Einstein"},{t:"If you want to live a happy life, tie it to a goal, not to people or things.",a:"Albert Einstein"},{t:"Time is an illusion.",a:"Albert Einstein"},{t:"God does not play dice.",a:"Albert Einstein"},{t:"The true sign of intelligence is not knowledge but imagination.",a:"Albert Einstein"},{t:"Everything must be made as simple as possible. But not simpler.",a:"Albert Einstein"},{t:"Information is not knowledge.",a:"Albert Einstein"},{t:"Coincidence is God's way of remaining anonymous.",a:"Albert Einstein"},{t:"You cannot solve a problem with the same mind that created it.",a:"Albert Einstein"},{t:"Logic will get you from A to B. Imagination will take you everywhere.",a:"Albert Einstein"},{t:"The only source of knowledge is experience.",a:"Albert Einstein"},{t:"Learn from yesterday, live for today, hope for tomorrow.",a:"Albert Einstein"},
            {t:"It is not that I'm so smart. But I stay with the questions much longer.",a:"Albert Einstein"},{t:"Creativity is contagious. Pass it on.",a:"Albert Einstein"},{t:"The measure of intelligence is the ability to change.",a:"Albert Einstein"},{t:"Great spirits have always encountered violent opposition from mediocre minds.",a:"Albert Einstein"},{t:"Gravity is not responsible for people falling in love.",a:"Albert Einstein"},{t:"Anyone who has never made a mistake has never tried anything new.",a:"Albert Einstein"},{t:"A ship is always safe at shore but that is not what it‚Äôs built for.",a:"Albert Einstein"},{t:"Education is what remains after one has forgotten what one has learned in school.",a:"Albert Einstein"},{t:"If you can't explain it to a six year old, you don't understand it yourself.",a:"Albert Einstein"},{t:"The world is a dangerous place to live; not because of the people who are evil, but because of the people who don't do anything about it.",a:"Albert Einstein"},{t:"I live in that solitude which is painful in youth, but delicious in the years of maturity.",a:"Albert Einstein"},{t:"Once we accept our limits, we go beyond them.",a:"Albert Einstein"},{t:"The important thing is not to stop questioning.",a:"Albert Einstein"},{t:"Only two things are infinite, the universe and human stupidity, and I'm not sure about the former.",a:"Albert Einstein"},{t:"Reality is merely an illusion, albeit a very persistent one.",a:"Albert Einstein"},{t:"Peace is not merely the absence of war but the presence of justice.",a:"Martin Luther King Jr."},{t:"Darkness cannot drive out darkness; only light can do that. Hate cannot drive out hate; only love can do that.",a:"Martin Luther King Jr."},{t:"The time is always right to do what is right.",a:"Martin Luther King Jr."},{t:"In the end, we will remember not the words of our enemies, but the silence of our friends.",a:"Martin Luther King Jr."},{t:"Faith is taking the first step even when you don't see the whole staircase.",a:"Martin Luther King Jr."},{t:"Our lives begin to end the day we become silent about things that matter.",a:"Martin Luther King Jr."},{t:"Love is the only force capable of transforming an enemy into a friend.",a:"Martin Luther King Jr."},
            {t:"We must accept finite disappointment, but never lose infinite hope.",a:"Martin Luther King Jr."},{t:"Change does not roll in on the wheels of inevitability, but comes through continuous struggle.",a:"Martin Luther King Jr."},{t:"If you can't fly then run, if you can't run then walk, if you can't walk then crawl, but whatever you do you must keep moving forward.",a:"Martin Luther King Jr."},{t:"Life's most persistent and urgent question is, 'What are you doing for others?'",a:"Martin Luther King Jr."},{t:"I have decided to stick with love. Hate is too great a burden to bear.",a:"Martin Luther King Jr."},{t:"Nothing in the world is more dangerous than sincere ignorance and conscientious stupidity.",a:"Martin Luther King Jr."},{t:"We must learn to live together as brothers or perish together as fools.",a:"Martin Luther King Jr."},{t:"Forgiveness is not an occasional act, it is a constant attitude.",a:"Martin Luther King Jr."},{t:"Freedom is never voluntarily given by the oppressor; it must be demanded by the oppressed.",a:"Martin Luther King Jr."},{t:"The ultimate measure of a man is not where he stands in moments of comfort and convenience, but where he stands at times of challenge and controversy.",a:"Martin Luther King Jr."},{t:"Lightning makes no sound until it strikes.",a:"Martin Luther King Jr."},{t:"A lie cannot live.",a:"Martin Luther King Jr."},{t:"There comes a time when one must take a position that is neither safe, nor politic, nor popular, but he must take it because conscience tells him it is right.",a:"Martin Luther King Jr."},{t:"He who passively accepts evil is as much involved in it as he who helps to perpetrate it.",a:"Martin Luther King Jr."},{t:"We must build dikes of courage to hold back the flood of fear.",a:"Martin Luther King Jr."},{t:"The quality, not the longevity, of one's life is what is important.",a:"Martin Luther King Jr."}
        ];

        function init() {
            render();
            updateBanner();
            if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
        }

        // RENDER
        function render() {
            ['red', 'yellow', 'green'].forEach(c => {
                const container = document.getElementById(`list-${c}`);
                if(container) {
                    container.innerHTML = '';
                    const filtered = items.filter(i => i.cat === c);
                    if (filtered.length === 0) {
                        let msg = "Empty";
                        if(c === 'red') msg = "No fires. Tap + to add.";
                        if(c === 'yellow') msg = "Flow is clear. Tap + to add.";
                        if(c === 'green') msg = "Peaceful. Tap + to add.";
                        container.innerHTML = `<div class="empty-msg" onclick="openModal('${c}')">${msg}</div>`;
                    } else {
                        filtered.forEach(item => {
                            const div = document.createElement('div');
                            div.className = `task-item ${c} ${item.done ? 'done' : ''}`;
                            div.innerHTML = `<div class="check-circle" onclick="toggleDone(${item.id})"></div><div class="task-text">${item.text}</div><button class="icon-btn" style="font-size:0.9rem; opacity:0.5" onclick="deleteItem(${item.id})">‚úï</button>`;
                            container.appendChild(div);
                        });
                    }
                }
            });
            
            document.getElementById('count-loop').innerText = `${items.filter(i => i.cat === 'loop').length} Active`;
            document.getElementById('count-marker').innerText = `${items.filter(i => i.cat === 'marker').length} Truths`;

            if(activePage) {
                const container = document.getElementById(`page-content-area`);
                container.innerHTML = '';
                const filtered = items.filter(i => i.cat === activePage);
                if (filtered.length === 0) {
                    container.innerHTML = `<div class="empty-msg" onclick="openModal('${activePage}')">Nothing here yet.<br>Tap to add.</div>`;
                } else {
                    filtered.forEach(item => createNoteElement(item, 'page-content-area', false));
                }
            }
        }

        function createNoteElement(item, containerId, isCheckable) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `task-item ${item.cat} ${item.done ? 'done' : ''}`;
            
            const check = isCheckable ? `<div class="check-circle" onclick="toggleDone(${item.id})"></div>` : '';
            
            div.innerHTML = `
                ${check}
                <div class="task-text">${item.text}</div>
                <div class="task-actions"><button class="icon-btn" style="font-size:0.9rem" onclick="deleteItem(${item.id})">‚úï</button></div>
            `;
            container.appendChild(div);
        }

        // --- NAVIGATION ---
        function openList(type) {
            activePage = type;
            const layer = document.getElementById('page-layer');
            const title = document.getElementById('page-title');
            if(type === 'loop') title.innerHTML = `<span class="logo-mind">MENTAL</span><div class="logo-dot"></div><span class="logo-tasks">LOOPS</span>`;
            else title.innerHTML = `<span class="logo-mind">PERMA</span><div class="logo-dot"></div><span class="logo-tasks">TRUTHS</span>`;
            layer.classList.add('active');
            render();
        }
        function closePage() { document.getElementById('page-layer').classList.remove('active'); activePage = null; render(); }

        // --- MODALS ---
        function openModal(preSelectCat) {
            document.getElementById('input-modal').classList.add('active');
            document.getElementById('input-text').focus();
            if(preSelectCat) {
                const pills = document.querySelectorAll('.pill');
                pills.forEach(p => {
                    if(p.innerText.toLowerCase().includes(preSelectCat === 'red' ? 'high' : preSelectCat === 'yellow' ? 'flow' : preSelectCat === 'green' ? 'gentle' : preSelectCat === 'loop' ? 'loop' : 'perma')) {
                        setCategory(preSelectCat, p);
                    }
                });
            } else setCategory('red', document.querySelector('.pill'));
        }
        function closeModal() { document.getElementById('input-modal').classList.remove('active'); document.getElementById('input-text').value = ''; }

        function setCategory(cat, el) {
            currentCat = cat; const pills = document.querySelectorAll('.pill');
            pills.forEach(p => p.classList.remove('selected'));
            if(el) el.classList.add('selected');
            else {
                pills.forEach(p => {
                    if(p.innerText.toLowerCase().includes(cat === 'red' ? 'high' : cat === 'yellow' ? 'flow' : cat === 'green' ? 'gentle' : cat)) 
                        p.classList.add('selected');
                });
            }
        }

        function saveNote() {
            const text = document.getElementById('input-text').value.trim();
            if(!text) return;
            items.push({ id: Date.now(), text, cat: currentCat, done: false });
            localStorage.setItem('auroraNotes', JSON.stringify(items));
            if(activePage) openList(activePage); else render();
            closeModal();
        }

        function deleteItem(id) {
            if(confirm("Dissolve this thought?")) {
                items = items.filter(i => i.id !== id);
                localStorage.setItem('auroraNotes', JSON.stringify(items));
                if(activePage) openList(activePage); else render();
            }
        }

        function toggleDone(id) { const item = items.find(i => i.id === id); if(item) { item.done = !item.done; localStorage.setItem('auroraNotes', JSON.stringify(items)); render(); } }

        // QUOTES
        function updateBanner() { const q = library[Math.floor(Math.random() * library.length)]; document.getElementById('banner-text').innerText = `"${q.t}"`; document.getElementById('banner-author').innerText = `- ${q.a}`; }
        function showQuote() { generateQuote(); document.getElementById('quote-modal').classList.add('active'); }
        function closeQuoteModal() { document.getElementById('quote-modal').classList.remove('active'); }
        function generateQuote() { const q = library[Math.floor(Math.random() * library.length)]; document.getElementById('modal-quote-text').innerText = q.t; document.getElementById('modal-quote-author').innerText = q.a; updateBanner(); }
        
        // INFO
        function openInfo() { document.getElementById('info-modal').classList.add('active'); }
        function closeInfo() { document.getElementById('info-modal').classList.remove('active'); }

        // TIMER & FIREFLIES
        let timerInt; let seconds = 300; let isRunning = false;

        function spawnFireflies() {
            const container = document.getElementById('fireflies'); container.classList.add('active'); container.innerHTML = '';
            for(let i=0; i<30; i++) {
                const fly = document.createElement('div'); fly.className = 'firefly';
                fly.style.left = Math.random() * 100 + 'vw'; fly.style.top = Math.random() * 100 + 'vh';
                fly.style.setProperty('--moveX', (Math.random() * 200 - 100) + 'px'); fly.style.setProperty('--moveY', (Math.random() * 200 - 100) + 'px');
                fly.style.animationDuration = (6 + Math.random() * 6) + 's'; fly.style.animationDelay = (Math.random() * 5) + 's';
                container.appendChild(fly);
            }
        }
        function clearFireflies() { document.getElementById('fireflies').classList.remove('active'); document.getElementById('fireflies').innerHTML = ''; }
        
        function playSound(type) {
            const AudioContext = window.AudioContext || window.webkitAudioContext; if (!AudioContext) return;
            const ctx = new AudioContext(); const osc = ctx.createOscillator(); const gain = ctx.createGain();
            osc.connect(gain); gain.connect(ctx.destination);
            
            if(type === 'ding') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(800, ctx.currentTime);
                gain.gain.setValueAtTime(0, ctx.currentTime); 
                gain.gain.linearRampToValueAtTime(0.1, ctx.currentTime + 0.05); 
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 1);
                osc.start(); osc.stop(ctx.currentTime + 1);
            } else {
                // Deep Tibetan Bowl (150Hz base)
                osc.type = 'sine'; osc.frequency.setValueAtTime(150, ctx.currentTime);
                gain.gain.setValueAtTime(0, ctx.currentTime); 
                gain.gain.linearRampToValueAtTime(0.3, ctx.currentTime + 0.1); 
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 6);
                osc.start(); osc.stop(ctx.currentTime + 6);
            }
        }

        function openTimer() { document.getElementById('timer-layer').classList.add('active'); document.getElementById('mainFab').style.display = 'none'; }
        function closeTimer() { document.getElementById('timer-layer').classList.remove('active'); resetTimer(); document.getElementById('mainFab').style.display = 'flex'; }

        function startSequence() {
            document.getElementById('timer-setup').classList.add('hidden'); document.getElementById('btn-start').style.display = 'none';
            const display = document.getElementById('timer-display');
            let count = 3; display.innerText = "Ready...";
            
            const countdown = setInterval(() => {
                if(count > 0) { playSound('ding'); display.innerText = count; count--; } 
                else { clearInterval(countdown); playSound('ding'); startActualTimer(); }
            }, 1000);
        }

        function startActualTimer() {
            const inputMin = parseInt(document.getElementById('custom-min').value) || 5; seconds = inputMin * 60;
            document.getElementById('breath-circle').classList.add('breathe'); spawnFireflies();
            
            // Show Pause/Stop controls
            document.getElementById('active-controls').classList.remove('hidden');
            document.getElementById('active-controls').style.display = 'flex';
            document.getElementById('btn-pause').innerText = "Pause";
            
            isRunning = true;
            timerInt = setInterval(() => {
                if(seconds > 0) { seconds--; const m = Math.floor(seconds / 60); const s = seconds % 60; document.getElementById('timer-display').innerText = `${m < 10 ? '0':''}${m}:${s < 10 ? '0':''}${s}`; } 
                else { finishTimer(); }
            }, 1000);
        }
        
        function togglePause() {
            if(isRunning) {
                clearInterval(timerInt); isRunning = false;
                document.getElementById('btn-pause').innerText = "Resume";
                document.getElementById('breath-circle').classList.remove('breathe'); // Freeze breathe
            } else {
                isRunning = true;
                document.getElementById('btn-pause').innerText = "Pause";
                document.getElementById('breath-circle').classList.add('breathe');
                timerInt = setInterval(() => {
                    if(seconds > 0) { seconds--; const m = Math.floor(seconds / 60); const s = seconds % 60; document.getElementById('timer-display').innerText = `${m < 10 ? '0':''}${m}:${s < 10 ? '0':''}${s}`; } 
                    else { finishTimer(); }
                }, 1000);
            }
        }
        
        function stopTimer() {
            closeTimer(); // Reset everything
            openTimer();  // Re-open fresh
        }

        function finishTimer() {
            clearInterval(timerInt); isRunning = false; document.getElementById('timer-display').innerText = "00:00";
            document.getElementById('breath-circle').classList.remove('breathe'); clearFireflies(); playSound('gong'); 
            alert("Focus Session Complete"); resetTimer();
        }

        function resetTimer() {
            clearInterval(timerInt); isRunning = false;
            document.getElementById('breath-circle').classList.remove('breathe'); 
            document.getElementById('timer-setup').classList.remove('hidden');
            
            // Reset buttons
            document.getElementById('active-controls').classList.add('hidden');
            document.getElementById('active-controls').style.display = 'none';
            document.getElementById('btn-start').style.display = 'block';
            
            const inputMin = document.getElementById('custom-min').value; 
            document.getElementById('timer-display').innerText = (inputMin < 10 ? "0" + inputMin : inputMin) + ":00";
            
            clearFireflies();
        }

        init();
    </script>
</body>
</html>
